## 小程序拍照后获取图像在IOS端页面显示正常，但传后台图像颠倒(小程序兼容处理)
> 之前做小程序遇到的兼容问题

```
// 拍照函数
bindToPhotograph: function () {
    let that = this;
    //创建CameraContext实例
    const ctx = wx.createCameraContext()
    //调用拍照API
    ctx.takePhoto({
        quality: 'high',
        success: (res) => {
            console.log(res)
            //异步储存照片文件的临时路径
            wx.setStorageSync(
                "photoPath", res.tempImagePath
            )
            this.setData({
                src: res.tempImagePath
            },function(){
                //调用成像函数
                that.draw(res.tempImagePath)
            })
        }
    })
},
//成像函数
draw:function(path){
    var that = this
    // 1. 绘制图片至canvas
    canvas.drawImage(path, 0, 0, that.data.canvasWidth, that.data.canvasHeight)

    // 绘制完成后执行回调，API 1.7.0
    canvas.draw(false, () => {
        // 2. 获取图像数据， API 1.9.0
        wx.canvasGetImageData({
            canvasId: 'canvas',
            x: 0,
            y: 0,
            width: 230,
            height: 230,
            success(res) {
                let platform = wx.getSystemInfoSync().platform
                if (platform == 'ios') {
                    // 兼容处理：ios获取的图片上下颠倒
                    res = that.reverseImgData(res)
                }
                // 3. png编码
                let pngData = upng.encode([res.data.buffer], res.width, res.height)
                // 4. base64编码
                let base64 = wx.arrayBufferToBase64(pngData)
                that.setData({
                    imgBase64: base64
                })
            }
        })
    })
},
//反转函数
reverseImgData(res) {
    var w = res.width
    var h = res.height
    let con = 0
    for (var i = 0; i < h / 2; i++) {
        for (var j = 0; j < w * 4; j++) {
            con = res.data[i * w * 4 + j]
            res.data[i * w * 4 + j] = res.data[(h - i - 1) * w * 4 + j]
            res.data[(h - i - 1) * w * 4 + j] = con
        }
    }
    return res
}
```

## 看到个转base64的链接  应该更方便[https://developers.weixin.qq.com/community/develop/doc/0002ea9b7b4c70d6b24751e1457804](https://developers.weixin.qq.com/community/develop/doc/0002ea9b7b4c70d6b24751e1457804)
